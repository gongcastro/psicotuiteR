<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creando psicotuiteR: Parte 1 • psicotuiteR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creando psicotuiteR: Parte 1">
<meta property="og:description" content="psicotuiteR">
<meta property="og:image" content="https://gongcastro.github.io/psicotuiteR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psicotuiteR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/creando-psicotuiteR-2.html">Creando psicotuiteR: Parte 2</a>
    </li>
    <li>
      <a href="../articles/creando-psicotuiteR.html">Creando psicotuiteR: Parte 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gongcastro/psicotuiter/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="creando-psicotuiteR_files/header-attrs-2.11.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creando psicotuiteR: Parte 1</h1>
                        <h4 class="author">Gonzalo Garcia-Castro (<span class="citation">@gongcastro</span>)</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gongcastro/psicotuiter/blob/master/vignettes/creando-psicotuiteR.Rmd"><code>vignettes/creando-psicotuiteR.Rmd</code></a></small>
      <div class="hidden name"><code>creando-psicotuiteR.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>
    message <span class="op">=</span> <span class="cn">FALSE</span>,
    warning <span class="op">=</span> <span class="cn">FALSE</span>,
    include <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gongcastro.github.io/psicotuiter/">psicotuiteR</a></span><span class="op">)</span></code></pre></div>
<p>En este tutorial explicaremos cómo se ha creado <strong>{psicotuiteR}</strong>. Trataremos de explicar cada paso lo mejor que podamos para que puedas replicarlo, contribuir al mismo paquete o incluso crear tu propio paquete en el futuro. El mejor recurso que existe en este momento para aprender a hacer paquetes de R es el manual <a href="https://r-pkgs.org/"><strong>R packages</strong></a> de Hadley Wickham y Jenny Bryan. No hay nada en este tutorial que no esté incluido ahí–incluso mejor explicado–a excepción de algún que otro comentario autodespectivo al pie de página.</p>
<div id="qué-es-un-paquete-de-r" class="section level2">
<h2 class="hasAnchor">
<a href="#qu%C3%A9-es-un-paquete-de-r" class="anchor"></a>¿Qué es un paquete de R?</h2>
<p>En <a href="https://r-pkgs.org/"><strong>R packages</strong></a>, se describe un paquete de R así: <em>In R, the fundamental unit of shareable code is the package. A package bundles together code, data, documentation, and tests, and is easy to share with others</em>. A mí me gusta definirlo como un grupo de funciones documentadas que se agrupan siguiendo el formato que el alto consejo jedi<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> ha dictado.</p>
</div>
<div id="por-qué-hacer-un-paquete-de-r" class="section level2">
<h2 class="hasAnchor">
<a href="#por-qu%C3%A9-hacer-un-paquete-de-r" class="anchor"></a>¿Por qué hacer un paquete de R?</h2>
<p>Cuando programamos, es común que necesitemos ejecutar la misma línea de código varias veces. Cuando esto ocurre, en lugar de escribir y ejecutar la misma línea de código una y otra vez en la consola de R, podemos escribir un <em>script</em>. Un script de R es un archivo con la extensión <code>.R</code><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> que contiene las diferentes líneas de código que queremos ejecutar.</p>
<p>A veces el mismo script contiene líneas de código muy parecidas que ejecutamos para aplicar, por ejemplo, la misma función sobre objetos diferentes. Por ejemplo:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">y</span>, data <span class="op">=</span> <span class="va">df1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">y</span>, data <span class="op">=</span> <span class="va">df2</span><span class="op">)</span></code></pre></div>
<p>En el bloque de código de arriba, <code>df1</code> y <code>df2</code> son objetos de tipo <em>data.frame</em> con variables similares pero diferentes observaciones. Idealmente, <strong>no deberíamos repetir la misma línea de código más de una vez</strong>. Digo idealmente porque la alternativa es escribir una función. No siempre merece la pena hacer una función, por mucho que la gente más purista insista. Si estás leyendo esto, doy por hecho que te interesa hacer tu código más conciso y replicable.</p>
<p>En ese caso es generalmente recomendable definir una serie de <strong>funciones</strong> antes de trabajar sobre tus datos. Una <strong>función</strong> es un conjunto de comandos que se ejecutan en orden cuando damos la orden<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. Estos comandos se agrupan bajo el nombre que asignemos a la función. Así podemos condensar nuestro código en funciones para que sea más conciso.</p>
<p>Por último, un paso más adelante es <strong>agrupar nuestras funciones en un paquete</strong>. Hacer esto tiene unos cuantos beneficios:</p>
<ul>
<li>No tendremos que definir las funciones cada vez que abramos un script: bastará con cargar el paquete y sus funciones estarán disponibles para usarlas</li>
<li>Será más fácil compartir nuestro código con otras personas: es común que nuestras funciones requieran, tener instalados ciertos paquetes externos. Por ejemplo, si mi función usa la función <code>mutate</code> del paquete dplyr, quien quiera usar mi función deberá tener instalado dplyr (a veces es inluso necesario tener instalada la misma versión del paquete). Este es uno de las principales amenazas a la reproducibilidad de nuestro código. Un paquete de R, sin embargo, se asegura que, durante la instalación, se instalen las dependencias necesarias en el ordenador de la otra persona</li>
<li>Podremos documentar las funciones fácilmente (se acabaron los comentarios escuestos e indescifrables en nuestros scripts) y hacer esta documentación accesible a quien use nuestro paquete al ejecutar <code>?mifuncion</code> (puedes ejecutar <code><a href="https://rdrr.io/r/base/mean.html">?mean</a></code> para ver un ejemplo de cómo se verá nuestra documentación).</li>
</ul>
<p>Hay más motivos por los que puede ser buena idea crear un paquete de R, como por ejemplo trabajar con tu propio código de forma más <strong>cómoda y reproducible</strong><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>, para compartir y <strong>documentar bases de datos</strong> (a veces nuestro paquete no incluirá ninguna función, sino únicamente unos datos y su documentación) o para <strong>aprender R más a fondo</strong> y sus entresijos. Yo he aprendido más intentando hacer paquetes de R que en cualquer tutorial.</p>
</div>
<div id="qué-necesito-para-hacer-un-paquete-de-r" class="section level2">
<h2 class="hasAnchor">
<a href="#qu%C3%A9-necesito-para-hacer-un-paquete-de-r" class="anchor"></a>¿Qué necesito para hacer un paquete de R?</h2>
<p>Para seguir este tutorial, y en general para crear un paquete de R necesitaremos instalar en nuestro ordenador<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>:</p>
<ul>
<li><a href="https://ftp.cixug.es/CRAN/">R</a></li>
<li><a href="https://www.rstudio.com/products/rstudio/download/">RStudio</a></li>
<li>Los siguientes paquetes de R: <a href="https://github.com/r-lib/devtools">devtools</a>, <a href="https://usethis.r-lib.org/">usethis</a> y <a href="https://rmarkdown.rstudio.com/">rmarkdown</a>.</li>
</ul>
<p>Puedes instalar estos paquetes así: <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("devtools", "usethis", "rmarkdown")</a></code>. Cuando tengamos todo instalado, reiniciaremos nuestra sesión de RStudio y después cargaremos devtools y usethis (usaremos rmarkdown más adelante):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://usethis.r-lib.org">usethis</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="inicializando-el-paquete" class="section level2">
<h2 class="hasAnchor">
<a href="#inicializando-el-paquete" class="anchor"></a>Inicializando el paquete</h2>
<p>Salvo contadas excepciones<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>, las personas de bien utilizan <strong>RStudio</strong> para programar en R, en lugar de usar únicamente la consola como hacen los psicópatas. Trabajar en un proyecto de RStudio nos facilitará mucho la vida al hacer un paquete de R y deberías hacerlo casi siempre que programas en R (como mínimo, te ahorrará mucho tiempo buscando documentos dentro de carpetas)<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<p>Para crear un paquete tenemos dos opciones: hacerlo a través de <strong>RStudio</strong> (ver <a href="https://support.rstudio.com/hc/en-us/articles/200486488-Developing-Packages-with-the-RStudio-IDE">tutorial</a>) o usando <strong><code>usethis</code></strong> en nuestra consola. a mí me gusta la segunda opción:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html">create_package</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"psicotuiteR"</span><span class="op">)</span> <span class="co"># abre nueva ventana</span></code></pre></div>
<p>Este comando creará una <strong>nueva carpeta</strong>. Lo hará dentro de tu repositorio de inicio, el cual puedes consultar ejecutando <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code> en tu consola. Esta carpeta contendrá varios archivos y una carpeta:</p>
<pre><code>#&gt;               levelName
#&gt; 1 .                    
#&gt; 2  ¦--.gitignore       
#&gt; 3  ¦--.Rbuildignore    
#&gt; 4  ¦--DESCRIPTION      
#&gt; 5  ¦--NAMESPACE        
#&gt; 6  ¦--psicotuiteR.Rproj
#&gt; 7  °--R</code></pre>
<p><strong>Importante</strong>: los nombres de la mayoría de archivos y carpetas en este directorio son importantes. Trata de no cambiarlos si no es imprescindible.</p>
<p>Uno de los archivos en la carpeta tiene el mismo nombre que el paquete y la extensión <code>.Rproj</code>. Cada vez que queramos trabajar en nuestro paquete es recomendable abrir la sesión de RStudio haciendo doble click sobre el archivo <code>.Rproj</code>. Veremos qué son el resto de archivos más adelante.</p>
<p>Pues bien: técnicamente, ¡ya tenemos un paquete de R! Si ejecutamos el código de abajo, el paquete se instalará como si fuera uno más en nuestro directorio de paquetes de R.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/install.html">install</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Encontrarás la carpeta de instalación junto a la de los demás paquetes que hays instalado en tu ordenador. Puedes consultar dónde se instalan tus paquetes de R ejecutando <code><a href="https://rdrr.io/r/base/libPaths.html">.libPaths()</a></code> en tu consola. La primera ruta que aparezca será donde encontrarás tu paquete instalado (en mi caso, encontraré la carpeta <code>~/Documents/R/win-library/4.0/psicotuiteR</code>).</p>
<p>La función que hemos ejecutado, <strong><code><a href="https://devtools.r-lib.org//reference/install.html">install()</a></code></strong> del paquete devtools simula lo que otra persona haría al ejecutar la función <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> si nuestro paquete estuviera disponible en CRAN. Ahora mismo, podríamos cargar nuestro paquete con <code><a href="https://gongcastro.github.io/psicotuiter/">library(psicotuiteR)</a></code> y trabajar con él. Por supuesto, nuestro paquete aún está vacío. En las próximas secciones veremos cómo añadir funciones, entre otras cosas, a nuestro paquete.</p>
<p>Antes de hacer eso, ahí va un truco: cuando añadimos o hacemos cambios en el paquete, necesitaremos actualizar nuestra sesión y cargar el paquete de nuevo y volver a ejecutar las funciones para comprobar que todo funciona correctamente. En lugar de ejecutar <code><a href="https://devtools.r-lib.org//reference/install.html">install()</a></code> cada vez que queremos ver si nuestro paquete funciona, podemos ejecutar <strong><code><a href="https://devtools.r-lib.org//reference/load_all.html">load_all()</a></code></strong> (también del paquete devtools) sin siquera reiniciar la sesión y así cargar de nuevo el paquete actualizado como si alguien hubiera cargado el paquete usando <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>. Los contenidos del paquete que se cargarán usando <code><a href="https://devtools.r-lib.org//reference/load_all.html">load_all()</a></code> son los que hay en el nuestro repositorio (desde el que estamos desarrollando el paquete), y no desde el directorio en el que se instala el paquete si ejecutamos <code><a href="https://devtools.r-lib.org//reference/install.html">install()</a></code>. ¡Esto es mucho más rápido y eficiente!</p>
<p>Otro truco: puesto que vamos a utilizar las funciones de los paquetes devtools y usethis a menudo–y por lo tanto vamos a necesitar cargar estos paquetes mediante <code><a href="https://devtools.r-lib.org/">library(devtools)</a></code> y <code><a href="https://usethis.r-lib.org">library(usethis)</a></code> cada vez que iniciemos una sesión de R– podría ser recomendable añadir esos dos comandos a nuestro archivo <strong>.Rprofile</strong> (ver esta <a href="https://support.rstudio.com/hc/en-us/articles/360047157094-Managing-R-with-Rprofile-Renviron-Rprofile-site-Renviron-site-rsession-conf-and-repos-conf">guía</a> para más información sobre .Rprofile. Las líneas de código que contenga ese archivo serán ejecutadas en cada inicio de sesión que hagamos en nuestro proyecto de RStudio. Podemos hacer esto usando las siguientes funciones de usethis:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://usethis.r-lib.org">usethis</a></span><span class="op">)</span>
<span class="fu"><a href="https://usethis.r-lib.org/reference/rprofile-helper.html">use_usethis</a></span><span class="op">(</span><span class="op">)</span> 
<span class="fu"><a href="https://usethis.r-lib.org/reference/rprofile-helper.html">use_devtools</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Esto creará un archivo llamado <strong>.Rprofile</strong> en nuestro directorio y añadirá, entre otras cosas muy útiles, los comandos <code><a href="https://usethis.r-lib.org">library(usethis)</a></code> y <code><a href="https://devtools.r-lib.org/">library(devtools)</a></code>.</p>
</div>
<div id="description" class="section level2">
<h2 class="hasAnchor">
<a href="#description" class="anchor"></a>DESCRIPTION</h2>
<p>El primer archivo que vamos a explicar se llama <strong>DESCRIPTION</strong>. La mayor parte de la <strong>información general</strong> (o meta-información) de nuestro paquete se encuentra en este archivo: autoría, ajustes generales, dependencias, etc. Puedes consultar el <a href="https://github.com/gongcastro/psicotuiteR/blob/2c8c7c47d97f02509dff0e26b42e41f93c88bd64/DESCRIPTION">DESCRIPTION</a> de psicotuiteR para hacerte una idea de cómo se ve cuando está editado. ¡Presta especial atención a cómo hemos indicado la autoría!</p>
<p>DESCRIPTION es uno de los pocos archivos que tendremos que editar tanto a mano como mediante otras funciones del paquete usethis. Tendremos que cambiar el título, autoría y descripción del paquete a mano (además de algún otro campo), mientras que, por ejemplo, los campos <em>Imports</em>, <em>Depends</em> y <em>Suggests</em> serán rellenados más adelante mediante la función <code><a href="https://usethis.r-lib.org/reference/use_package.html">use_package()</a></code>, de usethis. Cuando hablemos de dependencias, más adelante, comentaremos un par de cosas saobre estos tres campos.</p>
</div>
<div id="funciones-en-r" class="section level2">
<h2 class="hasAnchor">
<a href="#funciones-en-r" class="anchor"></a>Funciones en R</h2>
<p>Las funciones de R son el cuerpo principal de un paquete de R. Contienen el <strong>código que se ejecutará en nuestras funciones</strong> y su correspondiente <strong>documentación</strong>. Las funciones de por sí no tienen gran misterio. Las puedes hacer más simples o más complejas. Generalmente, por motivos de legibilidad suele ser mejor mantener nuestras funciones lo más simples que podamos. <strong>Es mejor escribir muchas funciones que hacen tareas pequeñas que pocas funciones que lo hacen todo</strong>. No tienes por qué hacer disponibles todas las funciones que escribas: puedes mantener algunas funciones para uso interno dentro de otras funciones que sí están disponibles al público (ahora veremos cómo). Hay muchos tutoriales para aprender a hacer funciones en R. Por ejemplo <a href="https://r-coder.com/function-r/">este</a>. Merece la pena ganar algo de confianza en poder hacer funciones de R: empodera mucho y te hace entender muchos de los errores que te encontrarás a lo largo de tu vida programando en R. Ahí va un ejemplo de función muy simple:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">print_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
    <span class="va">author</span> <span class="op">=</span> <span class="st">"Gon"</span>
<span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">author</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Esas líneas de código definen la función <code>print_name()</code>. Esta función incluye un argumento llamado <em>author</em>, que, por defecto, toma el valor <code>"Gon"</code>. Si definimos la función y ejecutamos <code>print_name()</code> en nuestra consola de R, nos devolverá el valor `“Gon”.</p>
<p>Guardaremos esta función en un archivo con la extensión .R dentro de la carpeta R/ en nuestro repositorio principal (el nombre que pongamos a este archivo da igual, pero trata de que sea informativo de su contenido). Yo llamaré a este archivo <code>print_name.R</code>. Ahora nuestro directorio se ve así:</p>
<pre><code>#&gt;               levelName
#&gt; 1 .                    
#&gt; 2  ¦--.gitignore       
#&gt; 3  ¦--.Rbuildignore    
#&gt; 4  ¦--DESCRIPTION      
#&gt; 5  ¦--NAMESPACE        
#&gt; 6  ¦--psicotuiteR.Rproj
#&gt; 7  °--R                
#&gt; 8      °--print_name.R</code></pre>
</div>
<div id="documentación" class="section level2">
<h2 class="hasAnchor">
<a href="#documentaci%C3%B3n" class="anchor"></a>Documentación</h2>
<p>Ahora vamos a <strong>documentar esa función</strong>. R utiliza un tipo de lenguaje parecido a LaTeX para escribir la documentación de un paquete. Este lenguaje se llama <strong>R documentation</strong>. Técnicamente, podríamos escribir toda la documentación de cada función de nuestro paquete en este lenguaje y guardar cada archivo en la carpeta man/ con la extensión .Rd. En esta carpeta es donde R espera encontrar la documentación. Gracias a Dios (y a la buena voluntad de la comunidad de R), podemos incluir los contenidos de esos archivos como si fueran comentarios en nuestros scripts de R, encima de cada función. La función <strong><code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code></strong> de devtools se encargará de generar todos los .Rd necesarios en la carpeta man/ por nosotrxs. Volveremos a esto más adelante. Por ahora, observa un ejemplo de función documentada:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Print author</span>
<span class="co">#' @export print_name</span>
<span class="co">#' @usage print_author()</span>
<span class="co">#' @import dplyr</span>
<span class="co">#' @importFrom tidyr drop_na</span>
<span class="co">#' @description Print the name of the author of the package we are developing</span>
<span class="co">#' @param author Name of the package author</span>
<span class="co">#' @author Gonzalo Garcia-Castro</span>
<span class="va">print_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
    <span class="va">author</span> <span class="op">=</span> <span class="st">"Gon"</span>
<span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">author</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>En la parte de abajo encontramos las mismas líneas de código que hemos visto antes. En la parte de arriba encontramos la documentación de la función. Estas líneas de código están <strong>precedidas por el símbolo <code>#'</code></strong>. La apóstrofe indica que no es un comentario cualquiera, sino parte de la documentación de la función. En la mayoría de estas líneas indicamos mediante el símbolo <strong><code><a href="https://rdrr.io/r/base/slotOp.html">@</a></code></strong> qué campo estamos describiendo (autoría, descripción, un argumento, etc.).</p>
<p>Por ejemplo, la línea de abajo indica que estamos describiendo uno de los argumentos de la función (por alguna razón que desconozco, se ha decidido refererirse a los argumentos como “<code>@param</code>” y no como <code>@arg</code>"). La primera línea se asume que es el título de la función y por eso no hace falta indicar <code>@title</code> antes de <code>"Print author"</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @param author Name of the package author</span></code></pre></div>
<p>Una vez hayamos rellenado la documentación de nuestra función, ejecutaremos <code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code> y se generará automáticamente un archivo llamado <code>print_name.Rd</code> en la carpeta man/. Podemos comprobar que la documentación se ha guardado correctamente ejecutando <code>?print_name</code>. Se debería abrir la ventana <em>Help</em> en uno de los paneles de RStudio. Algunos consejos cuando rellenes la documentación de tus funciones:</p>
<ul>
<li>Explica las cosas con <strong>claridad</strong>, pero no tengas miedo de extenderte o repetir las cosas. <strong>Más documentación siempre es mejor que menos documentación</strong>, siempre que se expliquen las cosas con claridad y se mantenga cierto sistema en la estructura de la documentación.</li>
<li>Echa un vistazo a la documentación de las funciones princpiales de tus paquetes favoritos. Es la mejor forma de saber cómo documentar un función y qué campos son los más importantes.</li>
</ul>
<div id="viñetas-y-artículos" class="section level3">
<h3 class="hasAnchor">
<a href="#vi%C3%B1etas-y-art%C3%ADculos" class="anchor"></a>Viñetas y artículos</h3>
<p>Una forma más elaborada de documentar un paquete es crear <strong>viñetas</strong>. Una viñeta (o <em>vignette</em>, en inglés) es un documento en el que se explica con detalle cómo se trabaja con el paquete, como si fuera un <strong>tutorial</strong>. Las viñetas son particularmente útiles para quienes usan el paquete por primera vez, y deberían ilustrar, como mínimo, algún ejemplo sobre cómo se usan las funciones. Un buen ejemplo de viñeta es <a href="https://dplyr.tidyverse.org/articles/grouping.html">esta</a>, del paquete {dplyr}, en la que indican cómo usar la función <code>group_by()</code>. Para crear una viñeta ejecutaremos el siguiente comando:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">use_vignette</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"print-name"</span> <span class="co"># así se llamará el archivo,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Imprimiendo un nombre"</span> <span class="co"># así se titulará la viñeta</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Este comando creará una carpeta llamada <strong>vignettes/</strong> y creará un archivo con la extensión .Rmd (Rmarkdown). Los archivos Rmarkdown son una mezcla entre un archivo <strong>Markdown</strong> (que tienen la extensión .md) y un script de R. Markdown es un lenguaje de edición de textos bastante sencillo (desde luego más sencillo que LaTeX). Rmarkdown permite intercalar bloques de código de R en medio del texto. Cuando renderizamos el documento, esos bloques de código se ejecutan y el resultado se incluye como texto o imagen. Este tipo de documentos son muy útiles para crear informes y actualizar los datos que incluyen con sólo un click. Si quieres aprender a user Rmarkdown (100% recomendado), el manual <a href="https://bookdown.org/yihui/rmarkdown/"><strong>R Markdown: The Definitive Guide</strong></a> de Yihui Xie es el mejor recurso. Una vez escribamos nuestra viñeta podremos incluirla en nuestra documentación ejecutando:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://devtools.r-lib.org//reference/build_vignettes.html">build_vignettes</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://devtools.r-lib.org//reference/document.html">document</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Como dato curioso, este mismo tutorial que estás leyendo es una viñeta incluida en el paquete psicotuiteR. Muy meta todo, ¿verdad?</p>
</div>
</div>
<div id="dependencias-y-otras-pesadillas" class="section level2">
<h2 class="hasAnchor">
<a href="#dependencias-y-otras-pesadillas" class="anchor"></a>Dependencias y otras pesadillas</h2>
<p>Con frecuencia, nuestras funciones de R dependerán, a su vez de funciones de otros paquetes. Considera la siguiente función:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Una función que añade una variable</span>
<span class="co">#' @param x Una serie de caracteres</span>
<span class="co">#' @returns El número incluido en x</span>
<span class="va">extrae_numeros</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">x</span>, <span class="st">"\\d"</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Como indica la documentación, esta función devuelve los números incluidos en <code>x</code>, una serie de caracteres que introducimos como argumento, en formato numérico. Para ello utiliza la función <code>str_extract()</code>. Esta función pertenece al paquete <a href="https://stringr.tidyverse.org/">{stringr}.</a> Tal y como está escrita esta función, cuando instalemos el paquete y la ejecutemos no dará un error: R nos indicará que la función <code>str_extract</code> no existe. Podría ocurrírsenos usar algo como <code><a href="https://stringr.tidyverse.org/reference/str_extract.html">stringr::str_extract</a></code> o <code><a href="http://stringr.tidyverse.org">library(stringr)</a></code> dentro de la función. Pero esto no es buena idea porque muchas veces no funcionará. Necesitamos incluir la función <code>str_extract</code> y stringr como <strong>dependencias</strong> de nuestro paquete, para que cuando alguien instale el paquete esa función se encuentre disponible para el paquete cuando ejecutemos nuestra función <code>extrae_numeros()</code>. Para indicar una dependencia, debemos hacerlo en dos pasos:</p>
<ol style="list-style-type: decimal">
<li>Ejecutar <strong><code><a href="https://usethis.r-lib.org/reference/use_package.html">use_package("stringr")</a></code></strong> para incluir stringr en la lista de paquetes que deben instalarse junto al nuestro. Al hacerlo, verás que stringr ha sido incluido en el campo <em>Imports</em> del archivo DESCRIPTION.</li>
<li>Incluir la función <strong><code>str_extract</code></strong> del paquete stringr en la documentación de la función de la siguiente forma:</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @importFrom stringr str_extract</span></code></pre></div>
<p>Ahora nuestra función debería verse así:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Una función que añade una variable</span>
<span class="co">#' @param x Una serie de caracteres</span>
<span class="co">#' @importFrom stringr str_extract</span>
<span class="co">#' @returns El número incluido en x</span>
<span class="va">extrae_numeros</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">x</span>, <span class="st">"\\d"</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>La función <code>str_extract</code> estará disponible y nuestra función podrá ejecutarse sin problemas. Otra opción sería <strong>importar el paquete stringr al completo</strong>, con todas sus funciones. En lugar de indicar <span class="citation">@importFrom</span> con el nombre del paquete y la función que queremos importar, indicaríamos <code>@import</code> y solamente nombre del paquete: <code>#' @import stringr</code>. Sin embargo, <strong>casi siempre es mejor indicar las dependencias una a una</strong>, aunque sea repetitivo: así será más fácil detectar de dónde viene cada función que usamos. Si vamos a usar varias funciones del mismo paquete, podemos indicarlas una debajo de otra:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @importFrom stringr str_extract</span>
<span class="co">#' @importFrom stringr str_detect</span>
<span class="co">#' @importFrom stringr str_replace</span></code></pre></div>
<p>Sólo en el caso de que utilicemos muchísimas funciones del mismo paquete en nuestra función tendrá cierto sentido importar el paquete al completo. <strong>Las dependencias de nuestro paquete sólo estará disponibles cuando ejecutemos <code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code> y se actualice la documentación</strong>. Esto es porque <code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code> no sólo construye la documentación del paquete (los archivos .Rd en man/), sino que también modifica el archivo NAMESPACE para enumerar las dependencias. Echa un vistazo a <a href="https://github.com/gongcastro/psicotuiteR/blob/082bb32fd9bdc95e21414d72a07dd586fd82a37a/NAMESPACE">NAMESPACE</a> de psicotuiteR. Este archivo ha sido generado al ejecutar <code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code>. Una de nuestras funciones incluye <code>#' @import janitor clean_names</code> y por tanto esta función ha sido incluida en el NAMESPACE.</p>
<p>Hemos aprendido a indicar dependencias de otros paquetes en nuestro código através de la documentación: funciones que nuestras propias funciones necesitan. Para hacer nuestras funciones disponibles en el paquete, necesitaremos incluirlas también en el NAMESPACE, pero no como dependencias, sino como <strong>exportaciones</strong>: en lugar de incluirlas en la documentación usando <code>@importFrom</code>, lo haremos usando <code>#' @export</code>. Volviendo al ejemplo anterior: <code>#' @export extrae_numeros</code>. Nuestra función se ver ahora así:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Una función que añade una variable</span>
<span class="co">#' @export extrae_numeros</span>
<span class="co">#' @param x Una serie de caracteres</span>
<span class="co">#' @importFrom stringr str_extract</span>
<span class="co">#' @returns El número incluido en x</span>
<span class="va">extrae_numeros</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">x</span>, <span class="st">"\\d"</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>La segunda línea indica que está función debe estar disponible en nuestro paquete con el nombre <code>extrae_numeros</code>. Aunque es posible exportar la función con un nombre diferente al que le hemos asignado en el script (R nos dará un aviso, pero no un error), es importante que así sea.</p>
<p>Podrías preguntarte: ¿qué sentido tiene crear funciones si no van a estar disponibles para quien use el paquete? Pues porque <strong>a veces es recomendable hacer funciones pequeñas para uso interno</strong> que, aunque su funcion no es de gran interés para el público, ayuden a otras funciones más complejas que sí tienen sentido que use el público. Sea como sea, técnicamente sí se puede acceder a este tipo de funciones usando el operador <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">:::</a></code>.</p>
<p>Si quieres hacer la prueba, ve a la consola de R y compara las sugerencias que salen cuando escribes <code>usethis::</code> y <code>usethis:::</code>. Todas esas funciones que salen en el segundo caso no están disponibles cuando cargamos el paquete usando <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> porque las personas que han creado el paquete usethis han considerado que no las necesitamos, aunque sí las necesitan las funciones que <em>sí</em> usamos.</p>
<p>En resumen, cuando ejecutemos <code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code>, se incluirán en el NAMESPACE las funciones que hayamos indicado en la documentación mediante <code>#' @export</code>. Nunca modificaremos NAMESPACE archivo a mano, sino que cambiaremos sus contenidos modificando la documentación de nuestras funciones en el script de R y luego ejecutaremos <code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code>. Con toda probabilidad, la mayoría de los problemas que vas a encontrar al desarrollar un paquete de R (también los más frustrantes) se deban a sus dependencias. Con el tiempo aprenderás a detectar estos problemas y entender por qué ocurren. Te damos un abrazo por adelantado: <em>been there, done that</em>.</p>
<p>Hay dos dependencias un poco especiales: si usamos <em>pipes</em>, “pipas”–o como quiera Dios que se traduzca al español–en nuestras funciones, en lugar de indicar <code># @importFrom dplyr %&gt;%</code> en cada función, podremos ejecutar <code><a href="https://usethis.r-lib.org/reference/use_pipe.html">use_pipe()</a></code> y esta función se encargará de incluir esta dependencia en la documentación por nosotros. Lo hará en un script llamado con el nombre de nuestro paquete, en la carpeta R/, que creará automáticamente. Si alguna de nuestras funciones devuelve un objeto en forma de <code>data.frame</code> y queremos usar la función <code>tibble</code>, del paquete <code>tibble</code> para que quede mejor, también podemos usar la función <code><a href="https://usethis.r-lib.org/reference/use_tibble.html">use_tibble()</a></code>, que hará lo mismo que <code><a href="https://usethis.r-lib.org/reference/use_pipe.html">use_pipe()</a></code>, aladiendo <code>tibble</code> a la lista de dependencias.</p>
<p>Por último, <strong>es recomendable mantener las dependencias de paquetes al mínimo</strong>. Cada vez que incluimos una dependencia corremos el riesgo de que alguno de los paquetes de los que dependemos cambie de versión y nuestro paquete deje de funcionar porque una de las funciones de ese paquete que utilizamos ha cambiado. CRAN impone un límite de dependencias en 20.</p>
</div>
<div id="datos-internos-datos-externos-datos-brutos" class="section level2">
<h2 class="hasAnchor">
<a href="#datos-internos-datos-externos-datos-brutos" class="anchor"></a>Datos internos, datos externos, datos brutos</h2>
<p>Muchos paquetes incluyen objetos del tipo <em>data.frame</em>. Por ejemplo, el paquete {dplyr} contiene el objeto <code>starwars</code>. Este objeto es un data.frame con información sobre muchos personajes del universo de Star Wars. Podemos acceder a este objeto así <code><a href="https://dplyr.tidyverse.org/reference/starwars.html">dplyr::starwars</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/starwars.html">starwars</a></span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 14</span>
<span class="co">#&gt;   name     height  mass hair_color  skin_color eye_color birth_year sex   gender</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span>
<span class="co">#&gt; 1 Luke Sk~    172    77 blond       fair       blue            19   male  mascu~</span>
<span class="co">#&gt; 2 C-3PO       167    75 &lt;NA&gt;        gold       yellow         112   none  mascu~</span>
<span class="co">#&gt; 3 R2-D2        96    32 &lt;NA&gt;        white, bl~ red             33   none  mascu~</span>
<span class="co">#&gt; 4 Darth V~    202   136 none        white      yellow          41.9 male  mascu~</span>
<span class="co">#&gt; 5 Leia Or~    150    49 brown       light      brown           19   fema~ femin~</span>
<span class="co">#&gt; 6 Owen La~    178   120 brown, grey light      blue            52   male  mascu~</span>
<span class="co">#&gt; # ... with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span>
<span class="co">#&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;</span></code></pre></div>
<p>Este objeto está documentado: si ejecutamos <code><a href="https://dplyr.tidyverse.org/reference/starwars.html">?dplyr::starwars</a></code> se abrirá el panel de documentación de RStudio. Este tipo de objetos son muy útiles para mostrar ejemplos de uso de las funciones de un paquete. Algunos paquetes incluso han sido diseñados con el único propósito de compartir una base de datos documentada, como por ejemplo el paquete {palmerpenguins}, que apenas contiene el objeto <code>penguins</code>: una base de datos sobre la anatomía demlos pingüinos de la Isla de Palmer. En esta sección veremos cómo incluir una base de datos como ésta en nuestro paqeute de R y cómo documentarla.</p>
<div id="datos-internos-y-externos" class="section level3">
<h3 class="hasAnchor">
<a href="#datos-internos-y-externos" class="anchor"></a>Datos internos y externos</h3>
<p>Podemos incluir un data.frame en nuestro paquete de dos formas: como un objeto interno o como un objeto externo. Hacerlo de la primera forma es el equivalente a crear una función sin exportarla al NAMESPACE: nos sirve para utilizarla dentro de las funciones internas del paquete, pero no será inmediatamente visible para quien cargue el paquete usando <code>library</code> (aunque igualmente podrá hacerlo usando el operador <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">:::</a></code>). Cuando incluimos el data.frame como objeto externo, sí se podrá acceder a él cuando cargemos el paquete (o mediante el operador <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">::</a></code>).</p>
<p>Para guardar un data.frame de cualquiera de las dos formas, primero debemos tenerlo definido entre lase variables de nuestra sesión. Por ejemplo, supón que hemos definido el data.frame <code>clima</code> (disponible en el paquete psicotuiteR):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">clima</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 37</span>
<span class="co">#&gt;      id lugar  genero     psico1    psico2 psico3 tw1    tw2   tw_pers tw_divulg</span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;      &lt;int&gt;  &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;     &lt;int&gt;</span>
<span class="co">#&gt; 1     1 Europa Mujer      Posgrado       3      4 Mas d~ Vari~       4         3</span>
<span class="co">#&gt; 2     2 Europa Hombre     Posgrado       1      5 Mas d~ Vari~       4         2</span>
<span class="co">#&gt; 3     3 Europa No binarie Posgrado       4      3 Menos~ Vari~       4         2</span>
<span class="co">#&gt; 4     4 Europa Hombre     Posgrado       4      3 Mas d~ Vari~       5         5</span>
<span class="co">#&gt; 5     5 Europa Hombre     Posgrado       5      1 Mas d~ Vari~       4         2</span>
<span class="co">#&gt; 6     6 Europa Hombre     Profesion      5      3 Mas d~ Vari~       1         4</span>
<span class="co">#&gt; # ... with 27 more variables: tw_anonim &lt;int&gt;, tw_tuits &lt;int&gt;,</span>
<span class="co">#&gt; #   tw_hilos_div &lt;int&gt;, tw_hilos_ot &lt;int&gt;, tw_rt &lt;int&gt;, tw_like &lt;int&gt;,</span>
<span class="co">#&gt; #   tw_resp &lt;int&gt;, exp_tw1 &lt;int&gt;, exp_tw2 &lt;int&gt;, exp_tw3 &lt;int&gt;, exp_tw4 &lt;int&gt;,</span>
<span class="co">#&gt; #   comp1 &lt;chr&gt;, comp2_verg &lt;int&gt;, comp2_quediran &lt;int&gt;, comp2_calidad &lt;int&gt;,</span>
<span class="co">#&gt; #   comp2_error &lt;int&gt;, comp2_conf &lt;int&gt;, comp2_nunca &lt;int&gt;, comp3_divulg &lt;int&gt;,</span>
<span class="co">#&gt; #   comp3_apren &lt;int&gt;, comp3_deb_cien &lt;int&gt;, comp3_deb_poli &lt;int&gt;,</span>
<span class="co">#&gt; #   comp3_pers &lt;int&gt;, comp3_nunca &lt;int&gt;, psico_tw1 &lt;chr&gt;, psico_tw2 &lt;int&gt;, ...</span></code></pre></div>
<p>Utilizaremos la función <code><a href="https://usethis.r-lib.org/reference/use_data.html">use_data()</a></code> del paquete usethis para incluirlo en nuestro paquete. Si queremos exportarlo al NAMESPACE especificaremos <code>internal = FALSE</code> en los argumentos de la función (opción por defecto). Si no queremos exportarlo especificaremos <code>internal = TRUE</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">clima</span><span class="op">)</span> <span class="co"># objeto externo</span>
<span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">clima</span>, internal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># objeto interno</span></code></pre></div>
<p>Esta función creará (en caso de que no exita ya) una carpeta en nuestro directorio llamada data/ y guardará el data.frame como un archivo .rds (como un objeto de R), en nuestro caso lo guardará con el nombre <code>clima.rds</code>. En el caso de que el objeto ya exista, debemos incluir <code>overwrite = TRUE</code> en los argumentos para que nos permita sobreescribirlo.</p>
<p><code><a href="https://usethis.r-lib.org/reference/use_data.html">use_data()</a></code> también creará un archivo llamado <code>clima.R</code> en la carpeta R. Como la extensión indica, este archivo es un script de R como el que usamos para las funciones. Debemos documentar nuestros datos en este archivo usando Roxigen, tal y como hacemos para las funciones. Echa un vistazo al archivo <a href="https://github.com/gongcastro/psicotuiteR/blob/082bb32fd9bdc95e21414d72a07dd586fd82a37a/R/clima.R"><code>clima.R</code></a> del paquete psicotuiteR. Verás que sólo contiene documentación, excepto por la línea final, que contiene <code>"clima"</code>. No necesita nada más que el nombre del objeto bajo el cual exportaremos el data.frame. De lo demás se encargará, como siempre la función <code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code>.</p>
</div>
<div id="datos-brutos" class="section level3">
<h3 class="hasAnchor">
<a href="#datos-brutos" class="anchor"></a>Datos brutos</h3>
<p>Hay una forma más de incluir datos, aun más reproducible que la anterior: incluir los datos brutos, como un archivo .csv, .txt, .tsv, .xlsx, etc., y he incluir en nuestro paquete el script de R con el código de R que hemos usando para procesar los datos contenidos en el archivo y llegar a la forma final del objeto que guaradamos mediante <code><a href="https://usethis.r-lib.org/reference/use_data.html">use_data()</a></code>. La función <code>use_raw_data()</code> del paquete usethis se encarga de esto.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">use_raw_data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Esta función creará dos carpetas (en caso de que no existan ya): inst/ y data-raw/. La carpeta inst/ (abreviatura de <em>installation</em>) de un paquete de R incluye archivos externos (por ejemplo, TXT, scripts de Python, Stan, C++…) que queremos que estén disponibles cuando alguien cargue el paquete, pero no son archivos que normalmente se incluyan en un paquete. Es recomendable guardar el archivo con nuestros datos brutos en la carpeta inst/. En la carpeta data-raw/ se creará un archivo con la extensión .R. En este archivo (que se abrirá automáticamente cuando ejecutemos <code><a href="https://usethis.r-lib.org/reference/use_data.html">use_data_raw()</a></code>) escribiremos el código que procesa los datos y los deja como queremos que se guarden en el paquete. La última línea del script (incluida por defecto) guarda el objeto resultante como datos externos mediante la función <code><a href="https://usethis.r-lib.org/reference/use_data.html">use_data()</a></code>. Así, cada vez que queramos actualizar el objeto, sólo tendremos que ejecutar este código.</p>
</div>
<div id="archivos-externos-e-inst" class="section level3">
<h3 class="hasAnchor">
<a href="#archivos-externos-e-inst" class="anchor"></a>Archivos externos e inst/</h3>
<p>Como hemos mencionado, cualquier archivo que queramos incluir en nuestro paquete y no tenga la extensión .R o .rds, debería estar dentro de la carpeta inst/. Cuando alguien instale el paquete, los archivos de esta carpeta se moverán al directorio principal del paquete. Puedes hacer la prueba ejecutando la función <code><a href="https://devtools.r-lib.org//reference/install.html">install()</a></code> de devtools. Cuando lo hayas hecho ve a la carpeta del paquete (recuerda que los paquetes se instalan en la primera ruta que indique <code><a href="https://rdrr.io/r/base/libPaths.html">.libPaths()</a></code>). Cualquier archivo que hayas dejado en la carpeta inst/ aparecerá en el directorio principal ahora. A veces querremos acceder a estos archivos dentro de nuestras funciones. Esto puede ser un poco complicado. La práctica más recomendable es hacerlo usando la función:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.file</span>(<span class="st">"clima.csv"</span>, <span class="at">package =</span> <span class="st">"psicotuiteR"</span>)<span class="st">`</span></span></code></pre></div>
<p>En la línea de código anterior, estaremos accediendo al archivo <code>clima.csv</code>, que hemos incluido en la carpeta inst/, pero que al instalar el paquete se encontrará en <code>~/Documents/R/win-library/4.0</code> (al menos en mi ordenador). Atención: si la función no encuentra ese archivo devolverá <code>""</code>, en lugar de un error. Esto puede llevar a confusión. Si quieres que la función devuelva un error si no encuentra el archivo, añade <code>mustWork = TRUE</code> a los argumentos:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.file</span>(<span class="st">"clima.csv"</span>, <span class="at">package =</span> <span class="st">"psicotuiteR"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)<span class="st">`</span></span></code></pre></div>
</div>
</div>
<div id="manteniendo-y-compartiendo-el-paquete" class="section level2">
<h2 class="hasAnchor">
<a href="#manteniendo-y-compartiendo-el-paquete" class="anchor"></a>Manteniendo y compartiendo el paquete</h2>
<div id="git-y-github" class="section level3">
<h3 class="hasAnchor">
<a href="#git-y-github" class="anchor"></a>Git y GitHub</h3>
<p>Un paquete de R puede volverse complejo en seguida: scripts con muchas funciones, funciones que dependen de otras funciones, funciones dependen de funciones de otros paquetes… Es fácil liarla. Git es una buena herramienta para controlar cómo va cambiando el paquete. Te permite llevar la cuenta de cómo ha cambiado cada archivo dentro del paquete, poder volver a una versión específica del mismo archivo, o tener diferentes versiones del mismo paquete funcionando a la vez de forma independiente. Este último punto es especialmente útil si queremos “jugar” con una versión de prueba del paquete mientras otras personas se pueden descargar una versión estable del mismo.</p>
<p>GitHub es una red social que permite almacenar y compartir repositorios mediante control de versiones en Git<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>. Varias personas pueden acceder al repositorio (un paquete de R, en nuestro caso) y sugerir cambios como si estuvieran trabajando sobre dicho paquete en un sólo ordenador. El mejor manual que conozco (y también el más accesible) para aprender a usar Git y GitHub (especialmente para quien ya trabaja en R) es <a href="https://happygitwithr.com/index.html"><em>Happy Git and GitHub for the useR</em></a>, de Jenny Bryan. Aprender git no siempre es fácil pero siempre merece la pena<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>.</p>
<p>Git y GitHub cumplen una función muy especial para quienes hacemos un paquete en R: la función <code>install_github</code>, del paquete {devtools}<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>, permite instalar un paquete sin necesidad de que esté publicado en CRAN. Hablaremos más adelante de CRAN, pero por ahora nos interesa saber que podemos compartir cualquier paquete a través de GitHub usando <code>install_github</code>, pero para poder instalarlo usando <code>install.packages</code>, como normalmente hacemos, ese paquete necesita estar publicado en CRAN. Publicar en CRAN requiere un proceso de revisión que en ocasiones es díficil solventar (y a veces innecesario). Para compartir nuestro paquete sin necesidad de pasar por ese calvario, lo haremos a través de GitHub.</p>
<p>Para hacerlo, primero debemos crear un usuario de GitHub, crear un nuevo repositorio, hacer click en el botón verde que dice “Code”, y copiar el enlace que aparece.</p>
<p><img src="img/github_code.PNG"></p>
<p>En nuestra sesión de R, ejecutamos las siguientes líneas de código:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://usethis.r-lib.org/reference/use_git.html">use_git</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># esta línea inicializa Git en el repositorio</span>
<span class="fu"><a href="https://usethis.r-lib.org/reference/use_git_remote.html">use_git_remote</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"origin"</span>, url <span class="op">=</span> <span class="st">"https://github.com/gongcastro/psicotuiteR.git"</span><span class="op">)</span> <span class="co"># sustituye ese link por el que hayas copiado de GitHub</span>
<span class="fu">use_github_ignore</span><span class="op">(</span><span class="op">)</span> <span class="co"># crea un archivo llamado .gitignore que indica a Git qué archivos ignorar</span>
<span class="fu"><a href="https://usethis.r-lib.org/reference/git_vaccinate.html">git_vaccinate</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># añade más cosas a .gitignore para evitar subir información sensible a GitHub</span></code></pre></div>
</div>
<div id="poniendo-a-prueba-el-paquete-con-testthat-y-test" class="section level3">
<h3 class="hasAnchor">
<a href="#poniendo-a-prueba-el-paquete-con-testthat-y-test" class="anchor"></a>Poniendo a prueba el paquete con {testthat} y <code>test()</code>
</h3>
<p>Los cambios que introducimos en nuestras funciones de R pueden provocar que fallos que a veces no detectamos inmediatamente. Algunos fallos no producen un error, sino que hacen que nuestras funciones se comporten de forma diferente a la que esperamos. Por ejemplo, un <em>data.frame</em> que devuelve nuestra función podría contener una variable con una clase <em>character</em> en lugar de <em>logical</em>. Este comportamiento indeseado podría pasar desapercibido cuando probemos las funciones que hemos cambiado. Para detectar estos problemas debemos poner a prueba todo el código cada vez que hacemos cambios. Hacer esto de forma manual cada vez puede ser muy tedioso. El paquete {testthat} se encarga de hacer esto por nosotros.</p>
<p>Si ejecutamos <code>use_testhat</code>, se creará una carpeta llamada <em>tests</em> en nuestro repositorio. Dentro de esta carpeta, hay otra carpeta llamada <em>testthat</em>. Cualquier script de R que guardemos en esa carpeta se ejecutará automáticamente cuando ejecutemos <code><a href="https://devtools.r-lib.org//reference/test.html">test()</a></code> en nuestra consola. Estos scripts deberían seguir tener el siguiente contenido:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">test_that</span><span class="op">(</span><span class="st">"Los datos de clima se cargan correctamente"</span>, <span class="op">{</span><span class="fu">expect_error</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"clima"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></code></pre></div>
<p>En esta línea de código estamos creando un test mediante la función <code>test_that</code> (del paquete {testhat}). Primero incluimos un mensaje que indique qué estamos “testeando” en específico (en este caso, que podemos cargar el dataset <code>clima</code> sin error. La función <code>expect_error</code> ejecuta el código de dentro, y evalúa si el resultado se corresponde con lo que indiquemos en el segundo argumento (en nuestro caso <code>NA</code>, que signifique que no hay fallo). Para ver con más detalle cómo poner a prueba el paquete que has creado, y aprender buenas prácticas en este tema puedes ver la documentación del paquete {testhat}.</p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>La gente que gestiona CRAN, vaya. Tienen cierta fama de boomers.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Por convención se suele usar la “R” mayúscula, aunque la mayoría de los sistemas operativos son indiferentes a que escribamos las extensiones en mayúsculas o minúsculas. Hagas lo que hagas, trata de ser consistente.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Definición mediocre pero obligada. Lo siento.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Tu <em>yo</em> futuro te lo agradecerá y si algún día se puede viajar en el tiempo lo harás para darte un beso en la frente por ello.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>En el momento de escribir este tutorial yo estoy usando R 4.0.4, RStudio 1.4.1103, rmarkdown 2.11.1, devtools 2.4.2 y usethis 2.0.1. Echa un vistazo a esta <a href="https://support.rstudio.com/hc/en-us/articles/219949047-Installing-older-versions-of-packages">guía</a> para ver cómo instalar una versión específica de un paquete de R.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Por ejemplo, si tienes el suficiente tiempo libre como para configurar una sesión de R medianamente funcional en Visual Studio Code.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Nunca está demás ver este <a href="https://slides.djnavarro.net/project-structure/#1">tutorial</a> de Danielle Navarro sobre cómo organizar un repositorio<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>No es la ’unica: Gitlab y Bitbucket, entre otras, hacen lo mismo, aunque son menos populares. No son propiedad de Microsoft.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>En mi honesta, humilde, ignorable opinión.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Más que un paquete de R, <code>devtools</code> es una collección de funciones de otros paquetes que han sido agrupadas por su utilidad a la hora de desarrollar paquetes (“devtools” es la abreviatura de <em>developer tools</em>). La función <code>install_github</code> pertenece, originalmente, al paquete {remotes}<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gonzalo Garcia-Castro, Alicia Franco-Martínez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
